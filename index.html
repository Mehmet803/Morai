<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>MÃ˜Râ€¢AI v5.55 ULTIMATE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #ffffff;
      --text: #111111;
      --bubble-user: #7c3aed;
      --bubble-bot: #e5e7eb;
      --accent: #7c3aed;
      --border: #d1d5db;
    }

    * { box-sizing: border-box; }

    body {
      margin:0;
      height:100vh;
      background:var(--bg);
      font-family:system-ui, sans-serif;
      display:flex;
      justify-content:center;
      align-items:center;
    }

    .app {
      width:100%;
      max-width:540px;
      height:100vh;
      display:flex;
      flex-direction:column;
      border-left:1px solid var(--border);
      border-right:1px solid var(--border);
      background:white;
    }

    header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:12px;
      border-bottom:1px solid var(--border);
      position:relative;
    }

    #settingsBtn {
      font-size:18px;
      cursor:pointer;
      padding:6px;
    }

    #settingsMenu {
      position:absolute;
      right:10px;
      top:45px;
      background:white;
      border:1px solid var(--border);
      border-radius:8px;
      padding:10px;
      width:180px;
      display:none;
      z-index:10;
    }

    #settingsMenu h3 {
      font-size:12px;
      margin-bottom:6px;
      color:#444;
    }

    #settingsMenu label {
      font-size:13px;
      display:block;
      margin:4px 0;
    }

    .chat {
      flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px;
    }

    .msg {
      max-width:75%;
      padding:8px 12px;
      border-radius:12px;
      font-size:14px;
      line-height:1.3;
      white-space:pre-line;
    }

    .user {
      margin-left:auto;
      background:var(--bubble-user);
      color:white;
    }

    .bot {
      background:var(--bubble-bot);
      color:var(--text);
      border:1px solid var(--border);
    }

    .inputBar {
      display:flex;
      gap:6px;
      padding:10px;
      border-top:1px solid var(--border);
    }

    #fileInput { display:none; }

    #fileBtn, #sendBtn, #micBtn {
      width:38px;height:38px;border-radius:50%;
      border:none;cursor:pointer;
      background:var(--accent);color:white;
      font-size:16px;
    }

    #input {
      flex:1;
      padding:10px;
      border:1px solid var(--border);
      border-radius:20px;
      font-size:14px;
    }

    .typing {
      font-size:12px;
      opacity:0.7;
      padding-left:4px;
    }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <b>MÃ˜Râ€¢AI v5.55</b>
      <div id="settingsBtn">âš™ï¸</div>

      <!-- AYAR MENÃœSÃœ -->
      <div id="settingsMenu">
        <h3>Ayarlar</h3>

        <label>
          <input type="checkbox" id="soundOn" checked />
          Sesli cevap
        </label>

        <label>
          Ses seÃ§imi:
          <select id="voiceSelect">
            <option value="female">KadÄ±n</option>
            <option value="male">Erkek</option>
          </select>
        </label>

        <label>
          <input type="checkbox" id="darkMode" />
          KaranlÄ±k tema
        </label>

        <label>
          <input type="checkbox" id="historySave" checked />
          GeÃ§miÅŸi kaydet
        </label>

      </div>
    </header>

    <div class="chat" id="chat"></div>

    <div class="inputBar">
      <input type="file" id="fileInput" accept="image/*"/>
      <button id="fileBtn">ğŸ“</button>
      <input id="input" placeholder="Bir ÅŸey yaz reisâ€¦"/>
      <button id="micBtn">ğŸ¤</button>
      <button id="sendBtn">â¡ï¸</button>
    </div>
  </div>

<script>

  // ===============================
// ZAMAN FORMATI
// ===============================
function time(){
  const d=new Date();
  return `${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;
}

// ===============================
// MESAJ EKLE
// ===============================
function addMsg({text="",user=false,img=null}){
  const row=document.createElement("div");
  row.className="msg "+(user?"user":"bot");

  if(img){
    const image=document.createElement("img");
    image.src=img;
    image.style.maxWidth="220px";
    image.style.borderRadius="12px";
    image.style.display="block";
    image.style.marginBottom="4px";
    row.appendChild(image);
  }

  if(text) row.appendChild(document.createTextNode(text));

  const meta=document.createElement("div");
  meta.style.fontSize="10px";
  meta.style.opacity="0.5";
  meta.style.marginTop="3px";
  meta.textContent=time();
  row.appendChild(meta);

  chat.appendChild(row);
  chat.scrollTop=chat.scrollHeight;
}

// ===============================
// YAZIYOR ANÄ°MASYONU
// ===============================
function botTyping(show){
  let t=document.getElementById("typing");
  if(show){
    if(!t){
      t=document.createElement("div");
      t.id="typing";
      t.className="typing";
      t.textContent="MÃ˜Râ€¢AI yazÄ±yorâ€¦";
      chat.appendChild(t);
    }
  }else{
    if(t) t.remove();
  }
  chat.scrollTop=chat.scrollHeight;
}

// ===============================
// Ã–ZEL KOMUTLAR
// ===============================
function commands(msg){
  if(msg==="/yardÄ±m"){
    addMsg({text:"Komutlar:\n/yardÄ±m\n/temizle\n/versiyon\nSesli cevap iÃ§in âš™ï¸ menÃ¼sÃ¼nÃ¼ kullan!",user:false});
    return true;
  }
  if(msg==="/temizle"){
    chat.innerHTML="";
    welcome();
    return true;
  }
  if(msg==="/versiyon"){
    addMsg({text:"MÃ˜Râ€¢AI v5.55 â€” TURBO ğŸ”¥",user:false});
    return true;
  }
  return false;
}

// ===============================
// TON ALGILAMA (Reis modu)
// ===============================
function getTone(msg){
  msg=msg.toLowerCase();
  if(msg.includes("reis")||msg.includes("kral")||msg.includes("aga")) return "street";
  if(msg.includes("allah")||msg.includes("dua")||msg.includes("kalp")) return "spiritual";
  if(msg.includes("neden")||msg.includes("nedir")||msg.includes("kimdir")) return "serious";
  return "normal";
}

  // ===============================
// SESLÄ° CEVAP â€” GOOGLE TTS
// ===============================
const googleVoices = {
  female: "tr-TR-Standard-A",
  male: "tr-TR-Standard-B"
};

function speak(text){
  if(!soundOn.checked) return; // Ses kapalÄ±ysa konuÅŸma
  const voice = voiceSelect.value;

  const url = `https://texttospeech.googleapis.com/v1/text:synthesize?key=AIzaSyDpdJFowop3v3_UvUcKPW0fX-MVbpqCTt0;  
  // NOT: GerÃ§ek API key'i sonra ekleyeceÄŸiz!
  // Åimdilik bot sessizce Ã§alÄ±ÅŸacak.

  console.log("KonuÅŸma hazÄ±rlanÄ±yor:", text);
}

// ===============================
// GÃ–RSEL ARAMA
// ===============================
function detectImage(msg){
  const low = msg.toLowerCase();
  if(
    low.includes("resim") ||
    low.includes("foto") ||
    low.includes("gÃ¶rsel")
  ){
    let t = low
      .replace("bana","")
      .replace("resmi","")
      .replace("resim","")
      .replace("foto","")
      .replace("fotoÄŸraf","")
      .replace("gÃ¶rsel","")
      .trim();
    return t || "manzara";
  }
  return null;
}

function showImage(topic){
  addMsg({
    text:`"${topic}" iÃ§in gÃ¶rsel ğŸ“·`,
    img:`https://source.unsplash.com/400x300/?${encodeURIComponent(topic)}`,
    user:false
  });
}

// ===============================
// SESLE KONUÅMA (MIC)
// ===============================
let recognition;
try{
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.lang = "tr-TR";
}catch(e){
  console.warn("Sesli tanÄ±ma desteklenmiyor");
}

micBtn.onclick = ()=>{
  if(!recognition){
    addMsg({text:"TarayÄ±cÄ± ses desteÄŸi yok reis âŒ",user:false});
    return;
  }
  addMsg({text:"Dinliyorum reis ğŸ‘‚",user:false});
  recognition.start();
};

if(recognition){
  recognition.onresult = (e)=>{
    const text = e.results[0][0].transcript;
    addMsg({text,user:true});
    botAnswer(text);
  };
}

// ===============================
// BÄ°LGÄ° KAYNAÄI â€” WIKIPEDIA
// ===============================
async function wiki(query){
  query = query
    .toLowerCase()
    .replace(" nedir","")
    .replace(" kimdir","")
    .replace("?","")
    .trim();

  const url = "https://tr.wikipedia.org/api/rest_v1/page/summary/"
            + encodeURIComponent(query);

  try{
    const res = await fetch(url);
    if(!res.ok) return null;
    const data = await res.json();
    if(!data.extract) return null;

    return data.extract + "\n\nKaynak: Vikipedi";
  }catch{
    return null;
  }
}

// ===============================
// BOT CEVAP MOTORU
// ===============================
async function botAnswer(msg){
  if(commands(msg)) return;

  const tone = getTone(msg);
  const img = detectImage(msg);

  // GÃ¶rsel istenmiÅŸse
  if(img){
    botTyping(true);
    await new Promise(r => setTimeout(r,600));
    botTyping(false);
    showImage(img);
    return;
  }

  addMsg({text:(tone==="street"?"BakÄ±yorum reisâ€¦":"AraÅŸtÄ±rÄ±yorumâ€¦"),user:false});

  botTyping(true);
  const info = await wiki(msg);
  botTyping(false);

  if(info){
    addMsg({text:info,user:false});
    speak(info);
  } else {
    const fallback = (tone==="street" ?
      "Reis bu konuda saÄŸlam kaynak bulamadÄ±m ğŸ˜…" :
      "Bununla ilgili bir bilgi bulamadÄ±m. Soruyu biraz daha aÃ§abilirsin.");
    addMsg({text:fallback,user:false});
    speak(fallback);
  }
}

// ===============================
// KULLANICI MESAJ GÃ–NDERME
// ===============================
sendBtn.onclick = send;
input.onkeydown = e=>{ if(e.key==="Enter") send(); };

function send(){
  const text = input.value.trim();
  if(!text) return;
  input.value="";
  addMsg({text,user:true});
  botAnswer(text);
}

// ===============================
// FOTOÄRAF YÃœKLEME
// ===============================
fileBtn.onclick = ()=>fileInput.click();

fileInput.onchange = ()=>{
  const file = fileInput.files[0];
  if(!file) return;
  const url = URL.createObjectURL(file);
  addMsg({img:url,user:true});
  setTimeout(()=>addMsg({text:"Foto geldi reis ğŸ“·",user:false}),400);
};

// ===============================
// AYAR MENÃœSÃœ
// ===============================
settingsBtn.onclick = ()=>{
  settingsMenu.style.display =
    settingsMenu.style.display==="block" ? "none" : "block";
};

// ===============================
// BAÅLANGIÃ‡ MESAJI
// ===============================
function welcome(){
  addMsg({
    text:
`Selam reis ğŸ‘‘
Ben **MÃ˜Râ€¢AI v5.55 TURBO**

âœ” TÃ¼rkÃ§e doÄŸal ses
âœ” FotoÄŸraf yolla
âœ” GÃ¶rsel iste: "aslan resmi gÃ¶nder"
âœ” Wikipediaâ€™dan bilgi
âœ” /yardÄ±m /temizle /versiyon

HazÄ±rsan baÅŸlayalÄ±m ğŸ’œ`,
    user:false
  });
}
welcome();

</script>
</body>
</html>
