
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>MÃ˜Râ€¢AI v6.0 (Reis Edition)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      /* Light theme defaults */
      --bg: #f9fafb;
      --bg-alt: #ffffff;
      --text: #0f172a;
      --soft: #6b7280;
      --border: #d1d5db;
      --bot-bubble: #e5e7eb;
      --user-bubble: linear-gradient(135deg,#6366f1,#a855f7);
      --accent: #7c3aed;
    }

    [data-theme="dark"] {
      --bg: #020617;
      --bg-alt: #020617;
      --text: #e5e7eb;
      --soft: #9ca3af;
      --border: #1e293b;
      --bot-bubble: #0f172a;
      --user-bubble: linear-gradient(135deg,#6366f1,#a855f7);
      --accent: #8b5cf6;
    }

    * { box-sizing:border-box; }

    body {
      margin:0;
      height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:var(--bg);
      font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color:var(--text);
    }

    .app {
      width:100%;
      max-width:540px;
      height:100vh;
      max-height:840px;
      display:flex;
      flex-direction:column;
      background:var(--bg-alt);
      border:1px solid var(--border);
      border-radius:18px;
      overflow:hidden;
    }

    header {
      padding:10px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid var(--border);
      background:var(--bg-alt);
    }

    .title {
      font-weight:700;
      font-size:15px;
    }

    .subtitle {
      font-size:11px;
      color:var(--soft);
    }

    .left-head {
      display:flex;
      flex-direction:column;
    }

    .theme-toggle {
      font-size:12px;
      display:flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      color:var(--soft);
    }

    .theme-toggle input {
      cursor:pointer;
    }

    .chat {
      flex:1;
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow-y:auto;
      background:radial-gradient(circle at top,rgba(148,163,184,0.15),transparent 60%);
    }

    .chat::-webkit-scrollbar { width:6px; }
    .chat::-webkit-scrollbar-thumb {
      background:rgba(148,163,184,0.6);
      border-radius:999px;
    }

    .msg-row {
      max-width:78%;
      display:flex;
      flex-direction:column;
    }

    .msg-row.user { align-self:flex-end; text-align:right; }
    .msg-row.bot  { align-self:flex-start; text-align:left; }

    .bubble {
      font-size:14px;
      line-height:1.35;
      white-space:pre-line;
    }

    .msg-row.user .bubble {
      background:var(--user-bubble);
      color:#f9fafb;
      padding:8px 11px;
      border-radius:14px;
      border-bottom-right-radius:4px;
    }

    .msg-row.bot .bubble {
      background:var(--bot-bubble);
      color:var(--text);
      padding:8px 11px;
      border-radius:14px;
      border-bottom-left-radius:4px;
    }

    .bubble img {
      max-width:220px;
      border-radius:12px;
      margin-bottom:4px;
      display:block;
    }

    .meta {
      font-size:10px;
      color:var(--soft);
      margin-top:3px;
    }

    .meta.right { text-align:right; }

    .typing {
      font-size:11px;
      color:var(--soft);
      margin-left:4px;
    }

    .input-bar {
      padding:8px 10px 10px;
      border-top:1px solid var(--border);
      display:flex;
      align-items:center;
      gap:6px;
      background:var(--bg-alt);
    }

    #fileInput { display:none; }

    .icon-btn {
      width:36px;
      height:34px;
      border-radius:999px;
      border:1px solid var(--border);
      background:var(--bg);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:16px;
    }

    #input {
      flex:1;
      border-radius:999px;
      border:1px solid var(--border);
      padding:8px 11px;
      font-size:14px;
      background:var(--bg);
      color:var(--text);
      outline:none;
    }

    #input::placeholder { color:var(--soft); }

    #input:focus {
      border-color:var(--accent);
      box-shadow:0 0 0 2px rgba(129,140,248,0.35);
    }

    #sendBtn {
      width:42px;
      height:34px;
      border-radius:999px;
      border:none;
      background:var(--accent);
      color:#f9fafb;
      cursor:pointer;
      font-size:17px;
    }

    @media (max-width:600px){
      .app { border-radius:0; max-height:100vh; }
    }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div class="left-head">
        <span class="title">MÃ˜Râ€¢AI v6.0</span>
        <span class="subtitle">TR bot Â· wiki + gÃ¶rsel Â· Reis modu</span>
      </div>
      <label class="theme-toggle">
        <input type="checkbox" id="themeCheckbox">
        <span id="themeLabel">â˜¾ KaranlÄ±k</span>
      </label>
    </header>

    <div class="chat" id="chat"></div>

    <div class="input-bar">
      <input type="file" id="fileInput" accept="image/*" />
      <button class="icon-btn" id="fileBtn">ğŸ“</button>
      <input id="input" placeholder="Bir ÅŸey yaz reisâ€¦  (/yardÄ±m)" />
      <button id="sendBtn">â¡ï¸</button>
    </div>
  </div>

<script>
// ======================
//  MÃ˜Râ€¢AI v6 â€” Frontend
//  Backend: GPT beyni
// ======================

// Backend URL (Vercel)
const MORAI_BACKEND_URL = "https://morai-backend.vercel.app/api/chat";

// DOM elemanlarÄ±nÄ± yakala (isimler farklÄ±ysa da Ã§oÄŸunu otomatik bulur)
const chatEl =
  document.getElementById("chat") || document.querySelector(".chat-area");
const inputEl =
  document.getElementById("userInput") ||
  document.getElementById("yazi") ||
  document.querySelector("input[type='text']");
const sendBtn =
  document.getElementById("sendBtn") ||
  document.querySelector(".send-btn") ||
  document.querySelector("[data-send]");

const fileInput = document.getElementById("fileInput");
const themeBtn = document.getElementById("themeBtn");
const micBtn =
  document.getElementById("micBtn") || document.querySelector(".mic-btn");

// KÃ¼Ã§Ã¼k gÃ¼venlik: kritik elemanlar yoksa hata verme
if (!chatEl || !inputEl || !sendBtn) {
  console.error("MÃ˜Râ€¢AI: chatEl / inputEl / sendBtn bulunamadÄ±.");
}

// Mesaj balonu ekleme
function addMessage({ text, isUser = false, isImage = false }) {
  if (!chatEl) return;

  const wrapper = document.createElement("div");
  wrapper.className = "message " + (isUser ? "user" : "bot");

  const bubble = document.createElement("div");
  bubble.className = "bubble";

  if (isImage) {
    const img = document.createElement("img");
    img.src = text;
    img.alt = "GÃ¶nderilen gÃ¶rsel";
    bubble.appendChild(img);
  } else {
    bubble.textContent = text;
  }

  const time = document.createElement("span");
  time.className = "time";
  time.textContent = new Date().toLocaleTimeString().slice(0, 5);

  wrapper.appendChild(bubble);
  wrapper.appendChild(time);
  chatEl.appendChild(wrapper);

  // Her mesajdan sonra alta kaydÄ±r
  chatEl.scrollTop = chatEl.scrollHeight;
}

// Backend'e istek atan fonksiyon
async function askMorAI(message) {
  try {
    const res = await fetch(MORAI_BACKEND_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message }),
    });

    if (!res.ok) {
      console.error("Backend hata:", res.status);
      return "Reis, beynin tarafÄ±nda bir sorun var gibi. Birazdan tekrar deneyelim.";
    }

    const data = await res.json();
    return data.reply || "Reis, dÃ¼zgÃ¼n bir cevap alamadÄ±m.";
  } catch (e) {
    console.error("Ä°stek hatasÄ±:", e);
    return "Reis, baÄŸlantÄ±da bir sÄ±kÄ±ntÄ± var gibi (internet ya da sunucu).";
  }
}

// Basit komutlar: /yardÄ±m, /temizle, /versiyon
function handleCommand(cmd) {
  if (cmd === "/yardÄ±m") {
    addMessage({
      isUser: false,
      text:
        "Komutlar:\n" +
        "â€¢ /yardÄ±m â†’ bu liste\n" +
        "â€¢ /temizle â†’ sohbeti siler\n" +
        "â€¢ /versiyon â†’ sÃ¼rÃ¼mÃ¼ sÃ¶yler",
    });
    return true;
  }

  if (cmd === "/versiyon") {
    addMessage({
      isUser: false,
      text: "MÃ˜Râ€¢AI v6.0 â€” GPT destekli, sallama yok reis. ğŸ’œ",
    });
    return true;
  }

  if (cmd === "/temizle") {
    if (chatEl) chatEl.innerHTML = "";
    addMessage({ isUser: false, text: "Sohbeti sÄ±fÄ±rladÄ±m reis. âœ…" });
    return true;
  }

  return false;
}

// Metinden gÃ¶rsel isteÄŸi yakalama (\"bana ... resmi gÃ¶nder\" gibi)
function detectImageTopic(text) {
  text = text.toLowerCase();
  if (text.includes("resmi gÃ¶nder") || text.includes("fotoÄŸraf gÃ¶nder")) {
    // "bana bir aslan resmi gÃ¶nder" â†’ "aslan"
    const cleaned = text
      .replace("bana", "")
      .replace("bir", "")
      .replace("resmi gÃ¶nder", "")
      .replace("fotoÄŸraf gÃ¶nder", "")
      .trim();
    return cleaned || null;
  }
  return null;
}

// Unsplash Ã¼zerinden rastgele gÃ¶rsel
function showImageFromUnsplash(topic) {
  const url = `https://source.unsplash.com/600x400/?${encodeURIComponent(
    topic
  )}`;
  addMessage({
    isUser: false,
    text: `â€œ${topic}â€ iÃ§in bir gÃ¶rsel gÃ¶steriyorum ğŸ“·`,
  });
  addMessage({ isUser: false, text: url, isImage: true });
}

// KullanÄ±cÄ± mesajÄ±nÄ± iÅŸleme
async function handleUserMessage(rawText) {
  const text = rawText.trim();
  if (!text) return;

  // Ã–nce kullanÄ±cÄ± balonu
  addMessage({ text, isUser: true });

  // Komutsa backend'e gitme
  if (handleCommand(text)) return;

  // GÃ¶rsel isteÄŸi mi?
  const topic = detectImageTopic(text);
  if (topic) {
    showImageFromUnsplash(topic);
    return;
  }

  // Normal soru â†’ backend'e sor
  addMessage({
    isUser: false,
    text: "BakÄ±yorum reis, beyne soruyorum...",
  });

  const reply = await askMorAI(text);
  addMessage({ isUser: false, text: reply });
}

// GÃ¶nderme fonksiyonu
function sendCurrentInput() {
  if (!inputEl) return;
  const value = inputEl.value;
  inputEl.value = "";
  handleUserMessage(value);
}

// Eventler
if (sendBtn) {
  sendBtn.addEventListener("click", () => {
    sendCurrentInput();
  });
}

if (inputEl) {
  inputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendCurrentInput();
    }
  });
}

// Tema butonu varsa basit dark/light toggle
if (themeBtn) {
  themeBtn.addEventListener("click", () => {
    document.body.classList.toggle("dark");
  });
}

// Dosya yÃ¼kleme sadece gÃ¶sterim iÃ§in
if (fileInput) {
  fileInput.addEventListener("change", () => {
    const file = fileInput.files?.[0];
    if (!file) return;
    addMessage({
      isUser: true,
      text: `ğŸ“ ${file.name} yÃ¼kledin (ÅŸimdilik sadece gÃ¶steriyorum).`,
    });
  });
}

// Mic butonu varsa "yakÄ±nda" mesajÄ±
if (micBtn) {
  micBtn.addEventListener("click", () => {
    addMessage({
      isUser: false,
      text: "Sesli konuÅŸma Ã¶zelliÄŸi yakÄ±nda reis ğŸ™ï¸",
    });
  });
}

// Sayfa aÃ§Ä±lÄ±nca karÅŸÄ±lama mesajÄ±
addMessage({
  isUser: false,
  text:
    "Selam reis ğŸ‘‘\nBen MÃ˜Râ€¢AI v6.0.\n\n" +
    "â€¢ GPT beyni ile konuÅŸurum\n" +
    "â€¢ \"bana aslan resmi gÃ¶nder\" dersen gÃ¶rsel gÃ¶steririm\n" +
    "â€¢ /yardÄ±m â†’ komutlarÄ± listeler\n" +
    "â€¢ /temizle â†’ sohbeti sÄ±fÄ±rlar\n" +
    "â€¢ /versiyon â†’ sÃ¼rÃ¼mÃ¼ sÃ¶yler\n\n" +
    "HazÄ±rsan baÅŸlayalÄ±m ğŸ’œ",
});
</script>
