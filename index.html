<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>M√òR‚Ä¢AI v6.0 (Reis Edition)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      /* Light theme defaults */
      --bg: #f9fafb;
      --bg-alt: #ffffff;
      --text: #0f172a;
      --soft: #6b7280;
      --border: #d1d5db;
      --bot-bubble: #e5e7eb;
      --user-bubble: linear-gradient(135deg,#6366f1,#a855f7);
      --accent: #7c3aed;
    }

    [data-theme="dark"] {
      --bg: #020617;
      --bg-alt: #020617;
      --text: #e5e7eb;
      --soft: #9ca3af;
      --border: #1e293b;
      --bot-bubble: #0f172a;
      --user-bubble: linear-gradient(135deg,#6366f1,#a855f7);
      --accent: #8b5cf6;
    }

    * { box-sizing:border-box; }

    body {
      margin:0;
      height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:var(--bg);
      font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color:var(--text);
    }

    .app {
      width:100%;
      max-width:540px;
      height:100vh;
      max-height:840px;
      display:flex;
      flex-direction:column;
      background:var(--bg-alt);
      border:1px solid var(--border);
      border-radius:18px;
      overflow:hidden;
    }

    header {
      padding:10px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid var(--border);
      background:var(--bg-alt);
    }

    .title {
      font-weight:700;
      font-size:15px;
    }

    .subtitle {
      font-size:11px;
      color:var(--soft);
    }

    .left-head {
      display:flex;
      flex-direction:column;
    }

    .theme-toggle {
      font-size:12px;
      display:flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      color:var(--soft);
    }

    .theme-toggle input {
      cursor:pointer;
    }

    .chat {
      flex:1;
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow-y:auto;
      background:radial-gradient(circle at top,rgba(148,163,184,0.15),transparent 60%);
    }

    .chat::-webkit-scrollbar { width:6px; }
    .chat::-webkit-scrollbar-thumb {
      background:rgba(148,163,184,0.6);
      border-radius:999px;
    }

    .msg-row {
      max-width:78%;
      display:flex;
      flex-direction:column;
    }

    .msg-row.user { align-self:flex-end; text-align:right; }
    .msg-row.bot  { align-self:flex-start; text-align:left; }

    .bubble {
      font-size:14px;
      line-height:1.35;
      white-space:pre-line;
    }

    .msg-row.user .bubble {
      background:var(--user-bubble);
      color:#f9fafb;
      padding:8px 11px;
      border-radius:14px;
      border-bottom-right-radius:4px;
    }

    .msg-row.bot .bubble {
      background:var(--bot-bubble);
      color:var(--text);
      padding:8px 11px;
      border-radius:14px;
      border-bottom-left-radius:4px;
    }

    .bubble img {
      max-width:220px;
      border-radius:12px;
      margin-bottom:4px;
      display:block;
    }

    .meta {
      font-size:10px;
      color:var(--soft);
      margin-top:3px;
    }

    .meta.right { text-align:right; }

    .typing {
      font-size:11px;
      color:var(--soft);
      margin-left:4px;
    }

    .input-bar {
      padding:8px 10px 10px;
      border-top:1px solid var(--border);
      display:flex;
      align-items:center;
      gap:6px;
      background:var(--bg-alt);
    }

    #fileInput { display:none; }

    .icon-btn {
      width:36px;
      height:34px;
      border-radius:999px;
      border:1px solid var(--border);
      background:var(--bg);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:16px;
    }

    #input {
      flex:1;
      border-radius:999px;
      border:1px solid var(--border);
      padding:8px 11px;
      font-size:14px;
      background:var(--bg);
      color:var(--text);
      outline:none;
    }

    #input::placeholder { color:var(--soft); }

    #input:focus {
      border-color:var(--accent);
      box-shadow:0 0 0 2px rgba(129,140,248,0.35);
    }

    #sendBtn {
      width:42px;
      height:34px;
      border-radius:999px;
      border:none;
      background:var(--accent);
      color:#f9fafb;
      cursor:pointer;
      font-size:17px;
    }

    @media (max-width:600px){
      .app { border-radius:0; max-height:100vh; }
    }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div class="left-head">
        <span class="title">M√òR‚Ä¢AI v6.0</span>
        <span class="subtitle">TR bot ¬∑ wiki + g√∂rsel ¬∑ Reis modu</span>
      </div>
      <label class="theme-toggle">
        <input type="checkbox" id="themeCheckbox">
        <span id="themeLabel">‚òæ Karanlƒ±k</span>
      </label>
    </header>

    <div class="chat" id="chat"></div>

    <div class="input-bar">
      <input type="file" id="fileInput" accept="image/*" />
      <button class="icon-btn" id="fileBtn">üìé</button>
      <input id="input" placeholder="Bir ≈üey yaz reis‚Ä¶  (/yardƒ±m)" />
      <button id="sendBtn">‚û°Ô∏è</button>
    </div>
  </div>

<script>
  // ---- Tema sistemi ----
  const htmlEl = document.documentElement;
  const themeCheckbox = document.getElementById("themeCheckbox");
  const themeLabel = document.getElementById("themeLabel");

  function applyTheme(theme) {
    htmlEl.setAttribute("data-theme", theme);
    if (theme === "dark") {
      themeCheckbox.checked = true;
      themeLabel.textContent = "‚òÄ A√ßƒ±k";
    } else {
      themeCheckbox.checked = false;
      themeLabel.textContent = "‚òæ Karanlƒ±k";
    }
    localStorage.setItem("morai-theme", theme);
  }

  // Ba≈ülangƒ±√ß temasƒ±
  const savedTheme = localStorage.getItem("morai-theme") || "dark";
  applyTheme(savedTheme);

  themeCheckbox.addEventListener("change", () => {
    applyTheme(themeCheckbox.checked ? "dark" : "light");
  });

  // ---- Chat elemanlarƒ± ----
  const chatEl = document.getElementById("chat");
  const inputEl = document.getElementById("input");
  const sendBtn = document.getElementById("sendBtn");
  const fileBtn = document.getElementById("fileBtn");
  const fileInput = document.getElementById("fileInput");

  function nowTime() {
    const d = new Date();
    return d.getHours().toString().padStart(2,"0")+":"+
           d.getMinutes().toString().padStart(2,"0");
  }

  function addMessage({ text="", isUser=false, imageUrl=null }) {
    const row = document.createElement("div");
    row.className = "msg-row " + (isUser ? "user" : "bot");

    const bubble = document.createElement("div");
    bubble.className = "bubble";

    if (imageUrl) {
      const img = document.createElement("img");
      img.src = imageUrl;
      img.alt = "g√∂rsel";
      bubble.appendChild(img);
    }

    if (text) {
      bubble.appendChild(document.createTextNode(text));
    }

    const meta = document.createElement("div");
    meta.className = "meta" + (isUser ? " right" : "");
    meta.textContent = nowTime();

    row.appendChild(bubble);
    row.appendChild(meta);
    chatEl.appendChild(row);
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  function showTyping(show) {
    let t = document.getElementById("typing");
    if (show) {
      if (!t) {
        t = document.createElement("div");
        t.id = "typing";
        t.className = "typing";
        t.textContent = "M√òR‚Ä¢AI yazƒ±yor‚Ä¶";
        chatEl.appendChild(t);
      }
    } else {
      if (t) t.remove();
    }
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  // ---- Komutlar ----
  function handleCommands(text) {
    if (text === "/yardƒ±m") {
      addMessage({
        text:
"Komutlar:\n"+
"/yardƒ±m  ‚Üí bu liste\n"+
"/temizle ‚Üí sohbeti siler\n"+
"/versiyon ‚Üí s√ºr√ºm√º g√∂sterir\n\n"+
"√ñrnek: \"boz ayƒ± nedir?\" ¬∑ \"bana kedi resmi g√∂nder\"",
        isUser:false
      });
      return true;
    }
    if (text === "/temizle") {
      chatEl.innerHTML = "";
      welcome();
      return true;
    }
    if (text === "/versiyon") {
      addMessage({ text:"M√òR‚Ä¢AI v6.0 (Reis Edition)", isUser:false });
      return true;
    }
    return false;
  }

  // ---- Ton algƒ± (eƒülence) ----
  function detectTone(text) {
    const t = text.toLowerCase();
    if (t.includes("reis") || t.includes("kral") || t.includes("aga"))
      return "street";
    if (t.includes("allah") || t.includes("dua") || t.includes("kalp"))
      return "spiritual";
    if (t.includes("nedir") || t.includes("kimdir") || t.includes("tarih"))
      return "serious";
    return "normal";
  }

  // ---- G√∂rsel isteƒüi ----
  function detectImageTopic(text) {
    const lower = text.toLowerCase();
    if (
      lower.includes("resim") ||
      lower.includes("foto") ||
      lower.includes("g√∂rsel")
    ) {
      let cleaned = lower
        .replace("bana","")
        .replace("resim","")
        .replace("resmi","")
        .replace("fotoƒüraf","")
        .replace("foto","")
        .replace("g√∂rsel","")
        .trim();
      if (!cleaned) cleaned = "nature";
      return cleaned;
    }
    return null;
  }

  function showImage(topic, tone) {
    const msg = (tone === "street")
      ? `"${topic}" i√ßin bir g√∂rsel g√∂steriyorum reis üì∑ (kaynak: Unsplash)`
      : `"${topic}" i√ßin bir g√∂rsel g√∂steriyorum üì∑ (kaynak: Unsplash)`;
    const url = "https://images.weserv.nl/?url=source.unsplash.com/600x400/?"+
                encodeURIComponent(topic);

    addMessage({ text: msg, isUser:false, imageUrl:url });
  }

  // ---- Wikipedia √∂zeti ----
  function normalizeWikiQuery(text) {
    let t = text.toLowerCase();
    t = t.replace(/\?/g," ");
    t = t.replace(" nedir"," ");
    t = t.replace(" kimdir"," ");
    t = t.replace(" hakkƒ±nda bilgi ver"," ");
    t = t.replace(" bana"," ");
    t = t.replace(/\s+/g," ").trim();
    if (!t) t = text.trim();
    return t;
  }

  async function fetchWikiSummary(text) {
    const q = normalizeWikiQuery(text);
    const url = "https://tr.wikipedia.org/api/rest_v1/page/summary/" +
                encodeURIComponent(q);
    try {
      const res = await fetch(url);
      if (!res.ok) return null;
      const data = await res.json();
      if (!data.extract) return null;
      let out = data.extract;
      if (out.length > 900) out = out.slice(0,880)+"...";
      out += "\n\nKaynak: Vikipedi";
      return out;
    } catch {
      return null;
    }
  }

  function wrapAnswer(tone, text) {
    if (tone === "street")
      return "Reis, bulabildiƒüim √∂zet ≈ü√∂yle üëá\n\n"+text;
    if (tone === "spiritual")
      return "Kaynaklarda bu konu kƒ±saca ≈ü√∂yle anlatƒ±lƒ±yor:\n\n"+text;
    if (tone === "serious")
      return "ƒ∞lgili kaynaklardan kƒ±sa bir √∂zet:\n\n"+text;
    return text;
  }

  async function handleBotReply(userText) {
    if (handleCommands(userText)) return;

    const tone = detectTone(userText);
    const imgTopic = detectImageTopic(userText);

    if (imgTopic) {
      showTyping(true);
      setTimeout(() => {
        showTyping(false);
        showImage(imgTopic, tone);
      }, 600);
      return;
    }

    const waitText = (tone === "street")
      ? "Bakƒ±yorum reis, Vikipedi'de ne var ne yok‚Ä¶"
      : "Bakƒ±yorum, Vikipedi'de ne bulabileceƒüim‚Ä¶";

    addMessage({ text:waitText, isUser:false });

    showTyping(true);
    const wikiText = await fetchWikiSummary(userText);
    showTyping(false);

    if (wikiText) {
      const wrapped = wrapAnswer(tone, wikiText);
      addMessage({ text:wrapped, isUser:false });
    } else {
      const failText = (tone === "street")
        ? "Reis bu konuda saƒülam bir kaynak bulamadƒ±m. Sallamak istemiyorum üòÖ"
        : "Bu konuda g√ºvenilir bir bilgi bulamadƒ±m, uydurmak istemiyorum.";
      addMessage({ text:failText, isUser:false });
    }
  }

  // ---- G√∂nderme ----
  function sendMessage() {
    const text = inputEl.value.trim();
    if (!text) return;
    addMessage({ text, isUser:true });
    inputEl.value = "";
    handleBotReply(text);
  }

  sendBtn.addEventListener("click", sendMessage);
  inputEl.addEventListener("keydown", e => {
    if (e.key === "Enter") {
      e.preventDefault();
      sendMessage();
    }
  });

  // ---- Fotoƒüraf y√ºkleme ----
  fileBtn.addEventListener("click", () => fileInput.click());
  fileInput.addEventListener("change", () => {
    const file = fileInput.files[0];
    if (!file) return;
    const url = URL.createObjectURL(file);
    addMessage({ imageUrl:url, isUser:true, text:"" });
    setTimeout(() => {
      addMessage({ text:"Fotoƒürafƒ±nƒ± g√∂rd√ºm reis üì∑", isUser:false });
    }, 400);
  });

  // ---- Kar≈üƒ±lama ----
  function welcome() {
    addMessage({
      text:
"Selam reis üëë\nBen M√òR‚Ä¢AI.\n\n"+
"‚Ä¢ Wikipedia'dan T√ºrk√ße √∂zet bulmaya √ßalƒ±≈üƒ±rƒ±m\n"+
"‚Ä¢ \"bana kedi resmi g√∂nder\" dersen g√∂rsel de g√∂steririm\n"+
"‚Ä¢ Fotoƒüraf y√ºklersen sadece g√∂r√ºnt√ºlerim\n"+
"‚Ä¢ Uydurma yok; bilmediƒüimde a√ßƒ±k√ßa s√∂ylerim.\n\n"+
"/yardƒ±m ‚Üí komut listesi\n"+
"/temizle ‚Üí sohbeti sƒ±fƒ±rlar\n"+
"/versiyon ‚Üí s√ºr√ºm√º yazar",
      isUser:false
    });
  }

  welcome();
</script>
</body>
</html>
